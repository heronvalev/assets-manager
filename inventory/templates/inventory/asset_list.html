{% extends "base.html" %}

{% block title %}Assets{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    
    <h2>Assets</h2>

    {% if perms.inventory.add_asset %}
        <a href="{% url 'create_asset' %}" class="btn btn-primary">Add Asset</a>
    {% endif %}

</div>

<div class="mb-3">
    <form method="get" class="row g-3">
        <!-- Status checkboxes -->
        <div class="col-auto">
            <label>Status:</label><br>
            {% for status in status_options %}
                <input type="checkbox" name="status" value="{{ status }}"
                    {% if status in selected_statuses %}checked{% endif %}> {{ status }}<br>
            {% endfor %}
        </div>

        <!-- Category checkboxes -->
        <div class="col-auto">
            <label>Category:</label><br>
            {% for category in category_options %}
                <input type="checkbox" name="category" value="{{ category }}"
                    {% if category in selected_categories %}checked{% endif %}> {{ category }}<br>
            {% endfor %}
        </div>

        <!-- Brand checkboxes -->
        <div class="col-auto">
            <label>Brand:</label><br>
            {% for brand in brand_options %}
                <input type="checkbox" name="brand" value="{{ brand }}"
                    {% if brand in selected_brands %}checked{% endif %}> {{ brand }}<br>
            {% endfor %}
        </div>

        <!-- Location checkboxes -->
        <div class="col-auto">
            <label>Location:</label><br>
            {% for location in location_options %}
                <input type="checkbox" name="location" value="{{ location }}"
                    {% if location in selected_locations %}checked{% endif %}> {{ location }}<br>
            {% endfor %}
        </div>

        <!-- Date filters -->
        <div class="col-auto">
            <label>Purchase Date:</label><br>
            <input type="date" name="start_date" value="{{ start_date }}">
            to
            <input type="date" name="end_date" value="{{ end_date }}">
        </div>

        <!-- Submit button -->
        <div class="col-auto align-self-end">
            <button type="submit" class="btn btn-primary">Apply Filters</button>
        </div>
    </form>
</div>

<div class="table-responsive">
    <table class="table table-bordered table-striped align-middle">
        <thead class="table-header">
            <tr>
                
                <th>
                    <a 
                        style="color:inherit; text-decoration:none;"
                        onmouseover="this.style.textDecoration='underline'"
                        onmouseout="this.style.textDecoration='none'"
                        href="?{% for key, value in request.GET.items %}{% if key != 'sort' %}{{ key }}={{ value }}&{% endif %}{% endfor %}sort={% if sort_field == 'name' %}-name{% else %}name{% endif %}"
                    >
                        Name
                        {% if sort_field == 'name' %}
                        ▲
                        {% elif sort_field == '-name' %}
                        ▼
                        {% endif %}
                    </a>
                </th>

                <th>
                    <a 
                        href="?{% for key, value in request.GET.items %}{% if key != 'sort' %}{{ key }}={{ value }}&{% endif %}{% endfor %}sort={% if sort_field == 'category' %}-category{% else %}category{% endif %}"
                        style="color: inherit; text-decoration: none;"
                        onmouseover="this.style.textDecoration='underline'"
                        onmouseout="this.style.textDecoration='none'"
                    >
                        Category
                        {% if sort_field == 'category' %}
                        ▲
                        {% elif sort_field == '-category' %}
                        ▼
                        {% endif %}
                    </a>
                </th>

                <th>
                    <a 
                        href="?{% for key, value in request.GET.items %}{% if key != 'sort' %}{{ key }}={{ value }}&{% endif %}{% endfor %}sort={% if sort_field == 'brand' %}-brand{% else %}brand{% endif %}"
                        style="color: inherit; text-decoration: none;"
                        onmouseover="this.style.textDecoration='underline'"
                        onmouseout="this.style.textDecoration='none'"
                    >
                        Brand
                        {% if sort_field == 'brand' %}
                        ▲
                        {% elif sort_field == '-brand' %}
                        ▼
                        {% endif %}
                    </a>
                </th>

                <th>
                    <a 
                        href="?{% for key, value in request.GET.items %}{% if key != 'sort' %}{{ key }}={{ value }}&{% endif %}{% endfor %}sort={% if sort_field == 'model' %}-model{% else %}model{% endif %}"
                        style="color: inherit; text-decoration: none;"
                        onmouseover="this.style.textDecoration='underline'"
                        onmouseout="this.style.textDecoration='none'"
                    >
                        Model
                        {% if sort_field == 'model' %}
                        ▲
                        {% elif sort_field == '-model' %}
                        ▼
                        {% endif %}
                    </a>
                </th>

                <th>
                    <a 
                        href="?{% for key, value in request.GET.items %}{% if key != 'sort' %}{{ key }}={{ value }}&{% endif %}{% endfor %}sort={% if sort_field == 'serial_number' %}-serial_number{% else %}serial_number{% endif %}"
                        style="color: inherit; text-decoration: none;"
                        onmouseover="this.style.textDecoration='underline'"
                        onmouseout="this.style.textDecoration='none'"
                    >
                        Serial Number
                        {% if sort_field == 'serial_number' %}
                        ▲
                        {% elif sort_field == '-serial_number' %}
                        ▼
                        {% endif %}
                    </a>              
                </th>
                    
                <th>
                    <a 
                        href="?{% for key, value in request.GET.items %}{% if key != 'sort' %}{{ key }}={{ value }}&{% endif %}{% endfor %}sort={% if sort_field == 'purchase_date' %}-purchase_date{% else %}purchase_date{% endif %}"
                        style="color: inherit; text-decoration: none;"
                        onmouseover="this.style.textDecoration='underline'"
                        onmouseout="this.style.textDecoration='none'"
                    >
                        Purchase Date
                        {% if sort_field == 'purchase_date' %}
                        ▲
                        {% elif sort_field == '-purchase_date' %}
                        ▼
                        {% endif %}
                    </a>
                </th>

                <th>
                    <a 
                        href="?{% for key, value in request.GET.items %}{% if key != 'sort' %}{{ key }}={{ value }}&{% endif %}{% endfor %}sort={% if sort_field == 'status' %}-status{% else %}status{% endif %}"
                        style="color: inherit; text-decoration: none;"
                        onmouseover="this.style.textDecoration='underline'"
                        onmouseout="this.style.textDecoration='none'"
                    >
                        Status
                        {% if sort_field == 'status' %}
                        ▲
                        {% elif sort_field == '-status' %}
                        ▼
                        {% endif %}
                    </a>
                </th>

                <th>Notes</th>

                <th>Currently Assigned?</th>

                <th>Current Location</th>
                
            </tr>

        </thead>
        <tbody>
            {% for asset in assets %}
            <tr>
                <td>
                    <a href="{% url 'asset_details' asset.id %}">{{ asset.name }}</a>
                </td>

                <td>{{ asset.category }}</td>
                <td>{{ asset.brand }}</td>
                <td>{{ asset.model }}</td>
                <td>{{ asset.serial_number }}</td>
                <td>{{ asset.purchase_date }}</td>
                <td>{{ asset.status }}</td>
                <td>{{ asset.notes }}</td>
                <td>
                    {% if asset.is_assigned %}
                        {% if asset.get_current_user %}
                            <a href="{% url 'user_assignments' asset.get_current_user.id %}">
                                {{ asset.get_current_user.upn }}
                            </a>
                        {% else %}
                        Team/Room
                        {% endif %}
                    {% else %}
                        Unassigned
                    {% endif %}
                </td>

                <td>{{ asset.get_current_location }}</td>
            </tr>
            {% empty %}
            <tr><td colspan="11">No assets found.</td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% endblock %}

